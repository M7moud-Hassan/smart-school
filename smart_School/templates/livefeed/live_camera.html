{% extends 'base_page.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'AdminLTE/plugins/ekko-lightbox/ekko-lightbox.css' %}">
<style>
  
  .small-box .icon > i{
  top: 0 !important;
  right: 0 !important;
  }

  .scroll-container {
  max-height: 400px;
  overflow-y: scroll; 
  overflow-x: hidden;
}
.bg-warning{
  background-color: rgb(242, 204, 89) !important;
}
.bg-success{
  background-color: rgba(134, 222, 91) !important;
}
.bg-danger{
  background-color: rgba(214, 92, 112) !important;
}



</style>
{% endblock %}
{% block content %}
<div class="content-wrapper">
            <div class="card card-danger shadow-lg">
              <div class="card-header">
                <h3 class="card-title">{{camera.name}} <span class="small text-success">Live</span></h3>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i>
                  </button>
                </div>
                <!-- /.card-tools -->
              </div>
              <!-- /.card-header -->
              <div class="card-body wh-100 row p-0 m-0">
                <img id="video" width="100%" src="" alt="loading.." height="100%" class="col-6 border mt-1">
                   <div  class="col-6">
                   
                  <div class="row w-100 p-0 m-2 scroll-container" id="result{{camera.id}}">
                    
                  </div>
               </div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
{% endblock %}

{% block  scripts %}
<script src="{% static 'AdminLTE/plugins/ekko-lightbox/ekko-lightbox.min.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/filterizr/jquery.filterizr.min.js' %}"></script>
 <script>
    $(function () {
      var screenHeight = $(window).height()/1.5;
      $('.scroll-container').css('max-height', screenHeight + 'px');
    $('#video').attr("src","/livefeed/video/{{camera.id}}")
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
      event.preventDefault();
      $(this).ekkoLightbox({
        alwaysShowClose: true
      });
    });
    setInterval(()=>{
    $.ajax({
                url: '/result_cameras/',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                  
                   data.data.forEach(function (obj) {
                  
                    var newDiv = `
                    <div class="col-11 p-0 m-0 mt-2">
            <!-- small box -->
            <div class="row p-0 m-0  bg-${obj.category}">
              <div class="col-8 pt-2" >
                <h3>${obj.name}</h3>
                <p>${obj.id}</p>
                <p>${obj.sort}</p>
              </div>
              <div class="col-4">
                <i class="">
                <a href="http://localhost:8000${obj.img}?text=${obj.name}" data-toggle="lightbox" data-title="${obj.des}">
                <img src="http://localhost:8000${obj.img}?text=${obj.name}" width="95%" height="100%" class="img-fluid m-2" alt="${obj.name}"/>
                </a>
              </i>
              </div>
            </div>
          </div>
    `;
  if (!$("#result"+obj.id_camera+" #p"+obj.id_person).length > 0) {
      $("#result"+obj.id_camera).append(newDiv);

   
    // $('.btn[data-filter]').on('click', function() {
    //   $('.btn[data-filter]').removeClass('active');
    //   $(this).addClass('active');
    // });
    // $('.filter-container').filterizr({gutterPixels: 3});
    }
            });
                },
                error: function (error) {

                    console.log('Error:', error);
                }
            });
   },500);

  });
  


 

 </script>
{% endblock %}