{% extends 'base_page.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'AdminLTE/plugins/select2/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'AdminLTE/plugins/ekko-lightbox/ekko-lightbox.css' %}">
<style>
    .select2-selection__choice{
    background-color: #2196f3 !important;
border: none !important;
    }
</style>
{% endblock %}
{% block content %}
<div class="content-wrapper">
      <div class="form-group p-4">
                                    <label>Choose Camera:</label>
                                    <select class="select2" multiple="multiple" data-placeholder="Any" style="width: 100%;">
                                        {% for camera in cameras %}
                                        <option value="{{camera.id}}">{{camera.name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
    <div id="bodyCameras" class="row p-0 m-0">
<!--<div id="camera'+id+'" class="col-md-6 col-12">-->
<!--    <div class="card card-success">-->

<!--      <div class="card-header">-->
<!--        <h3 class="card-title">'+name+'</h3>-->
<!--        <div class="card-tools">-->
<!--          <button type="button" class="btn btn-tool" data-card-widget="maximize">-->
<!--            <i class="fas fa-expand"></i>-->
<!--          </button>-->
<!--          <button type="button" class="btn btn-tool" data-card-widget="collapse">-->
<!--            <i class="fas fa-minus"></i>-->
<!--          </button>-->
<!--          <button type="button" onclick="closeCamera(' + id + ',\'' + name + '\')" class="btn btn-tool" data-card-widget="remove">-->
<!--            <i class="fas fa-times"></i>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--      <div class="card-body" style="height: 600px;">-->
<!--        <img id="video'+id+'" src="/livefeed/video/4" width="100%" height="60%"/>-->
<!--               <div style="height:40%;overflow-y:hidden">-->
<!--                    <div>-->
<!--                  <div class="btn-group w-100 mb-2">-->
<!--                    <a class="btn btn-info active" href="javascript:void(0)" data-filter="all"> All</a>-->
<!--                    <a class="btn btn-info" href="javascript:void(0)" data-filter="1"> List (WHITE) </a>-->
<!--                    <a class="btn btn-info" href="javascript:void(0)" data-filter="2"> List (BLACK) </a>-->
<!--                    <a class="btn btn-info" href="javascript:void(0)" data-filter="3"> List (Unknown) </a>-->
<!--                    <a class="btn btn-info" href="javascript:void(0)" data-filter="4"> List (Know) </a>-->
<!--                  </div>-->
<!--                  <div class="mb-2">-->
<!--                    <a class="btn btn-secondary" href="javascript:void(0)" data-shuffle>Shuffle</a>-->
<!--                  </div>-->
<!--                </div>-->
<!--                  <div class="filter-container p-0 row" style="overflow-y:scroll" id="result1">-->
<!--                 </div>-->
<!--               </div>-->
<!--      </div>-->
<!--    </div>-->

<!--  </div>-->
    </div>
</div>
{% endblock %}
{% block scripts %}

<script src="{% static 'AdminLTE/plugins/select2/js/select2.full.min.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/ekko-lightbox/ekko-lightbox.min.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/filterizr/jquery.filterizr.min.js' %}"></script>
<script>


     $(function () {
      $('.select2').select2();
      $('.select2').on('select2:select', function(e) {
      // 'e.params.data' contains the selected option data
      var selectedOption = e.params.data;
      addCamera(selectedOption.id,selectedOption.text);

    });

     $('.select2').on('select2:unselect', function(e) {
    var unselectedOption = e.params.data;
    closeCamera(unselectedOption.id,unselectedOption.text);
  });


    });
 function addCamera(id,name) {

  $('#bodyCameras').append('<div id="camera'+id+'" class="col-md-6 col-12"> \
    <div class="card card-success"> \
    <div id="overlay'+id+'" class="overlay dark"><i class="fas fa-3x fa-sync-alt"></i></div>\
      <div class="card-header"> \
        <h3 class="card-title">'+name+'</h3> \
        <div class="card-tools"> \
          <button type="button" class="btn btn-tool" data-card-widget="maximize"> \
            <i class="fas fa-expand"></i> \
          </button> \
          <button type="button" class="btn btn-tool" data-card-widget="collapse"> \
            <i class="fas fa-minus"></i> \
          </button> \
          <button type="button" onclick="closeCamera(' + id + ',\'' + name + '\')" class="btn btn-tool" data-card-widget="remove"> \
            <i class="fas fa-times"></i> \
          </button> \
        </div> \
      </div> \
      <div class="card-body" style="height: 600px;"> \
        <img id="video'+id+'" src="/livefeed/video/' + id + '" width="100%" height="60%"/> \
          <div style="height:40%;overflow-y:hidden">\
                    <div>\
                  <div class="btn-group w-100 mb-2">\
                    <a class="btn btn-info btns-'+id+' active" href="javascript:void('0')" data-filter="all"> All</a>\
                    <a class="btn btn-info btns-'+id+'" href="javascript:void('0')" data-filter="1"> List (WHITE) </a>\
                    <a class="btn btn-info btns-'+id+'" href="javascript:void('0')" data-filter="2"> List (BLACK) </a>\
                    <a class="btn btn-info btns-'+id+'" href="javascript:void('0')" data-filter="3"> List (Unknown) </a>\
                    <a class="btn btn-info btns-'+id+'" href="javascript:void('0')" data-filter="4"> List (Know) </a>\
                  </div>\
                  <div class="mb-2">\
                    <a class="btn btn-secondary" href="javascript:void(0)" data-shuffle>Shuffle</a>\
                  </div>\
                </div>\
                  <div class="filter-container'+id+' p-0 row" style="overflow-y:scroll" id="result'+id+'">\
                 </div>\
               </div>\
      </div> \
    </div> \
  </div>');

 setTimeout(() => {
  $("#overlay" + id).hide();

}, 13000);
    }
    function closeCamera(id,name){
    var liElementWithTitleAhmed = $('li[title=\'' + name + '\']');
  var spanChild = liElementWithTitleAhmed.find('span.select2-selection__choice__remove');
  spanChild.click();
    $.ajax({
    url: "/cameras/release_camera/"+id,
    type: "GET",
    success: function(data) {

    },
    error: function(xhr, status, error) {

      console.error(error);
    }
  });
  setTimeout(()=>{
  $('#video' + id).attr("src","");
  $('#camera' + id).remove();
  },1000);
    }
   setInterval(()=>{
    $.ajax({
                url: '/result_cameras/',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                   data.data.forEach(function (obj) {
                    console.log(obj);
                    var newDiv = `
      <div class="filtr-item col-sm-2" data-category="${obj.category}" data-sort="${obj.sort}" id="p${obj.id_person}">
        <a href="http://localhost:8000${obj.img}?text=${obj.name}" data-toggle="lightbox" data-title="${obj.des}">
          <img src="http://localhost:8000${obj.img}?text=${obj.name}" class="img-fluid mb-2" alt="${obj.name}"/>
        </a>
        <p><small>${obj.name}</small></p>
      </div>
    `;
  if (!$("#result"+obj.id_camera+" #p"+obj.id_person).length > 0) {
      $("#result"+obj.id_camera).append(newDiv);
    $('.filter-container'+obj.id_camera).filterizr({gutterPixels: 0});
    $('.btns-'+obj.id_camera+'[data-filter]').on('click', function() {
      $('.btns-'+obj.id_camera+'[data-filter]').removeClass('active');
      $(this).addClass('active');
    });
    }
            });
                },
                error: function (error) {

                    console.log('Error:', error);
                }
            });
   },500);

   $(function () {
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
      event.preventDefault();
      $(this).ekkoLightbox({
        alwaysShowClose: true
      });
    });
  })
</script>
{% endblock %}
