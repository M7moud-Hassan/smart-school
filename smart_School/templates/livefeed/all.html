{% extends 'base_page.html' %}
{% load static %}
{% block styles %}
<link rel="stylesheet" href="{% static 'AdminLTE/plugins/select2/css/select2.min.css' %}">
<style>
    .select2-selection__choice{
    background-color: #2196f3 !important;
border: none !important;
    }
</style>
{% endblock %}
{% block content %}
<div class="content-wrapper">
      <div class="form-group p-4">
                                    <label>Choose Camera:</label>
                                    <select class="select2" multiple="multiple" data-placeholder="Any" style="width: 100%;">
                                        {% for camera in cameras %}
                                        <option value="{{camera.id}}">{{camera.name}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
    <div id="bodyCameras" class="row p-0 m-0">

    </div>
</div>
{% endblock %}
{% block scripts %}

<script src="{% static 'AdminLTE/plugins/select2/js/select2.full.min.js' %}"></script>
<script>


     $(function () {
      $('.select2').select2();
      $('.select2').on('select2:select', function(e) {
      // 'e.params.data' contains the selected option data
      var selectedOption = e.params.data;
      addCamera(selectedOption.id,selectedOption.text);

    });

     $('.select2').on('select2:unselect', function(e) {
    var unselectedOption = e.params.data;
    closeCamera(unselectedOption.id,unselectedOption.text);
  });


    });
 function addCamera(id,name) {

  $('#bodyCameras').append('<div id="camera'+id+'" class="col-md-6 col-12"> \
    <div class="card card-success"> \
    <div id="overlay'+id+'" class="overlay dark"><i class="fas fa-3x fa-sync-alt"></i></div>\
      <div class="card-header"> \
        <h3 class="card-title">'+name+'</h3> \
        <div class="card-tools"> \
          <button type="button" class="btn btn-tool" data-card-widget="maximize"> \
            <i class="fas fa-expand"></i> \
          </button> \
          <button type="button" class="btn btn-tool" data-card-widget="collapse"> \
            <i class="fas fa-minus"></i> \
          </button> \
          <button type="button" onclick="closeCamera(' + id + ',\'' + name + '\')" class="btn btn-tool" data-card-widget="remove"> \
            <i class="fas fa-times"></i> \
          </button> \
        </div> \
      </div> \
      <div class="card-body" style="height: 350px;"> \
        <img id="video'+id+'" src="/cameras/video/' + id + '" width="100%" height="100%"/> \
      </div> \
    </div> \
  </div>');
 setTimeout(() => {
  $("#overlay" + id).hide();
}, 13000);
    }
    function closeCamera(id,name){
    var liElementWithTitleAhmed = $('li[title=\'' + name + '\']');
  var spanChild = liElementWithTitleAhmed.find('span.select2-selection__choice__remove');
  spanChild.click();
    $.ajax({
    url: "/cameras/release_camera/"+id,
    type: "GET",
    success: function(data) {

    },
    error: function(xhr, status, error) {

      console.error(error);
    }
  });
  setTimeout(()=>{
  $('#video' + id).attr("src","");
  $('#camera' + id).remove();
  },1000);
    }
</script>
{% endblock %}
